---
title: "Alcohol Consumption in Schools"
author: "Hypothesis Heroes - Drew Davison, Lisa Zhang, Ellie Culman, Austin Chang"
date: "11/14/23"
format: pdf
execute: 
  warning: false
  message: false
  echo: false
editor: visual
---

```{r}
#| label: load packages and data
library(tidyverse)
library(tidymodels)
```

## Introduction

All around the world, underage drinking among students is a significant public health issue and takes a huge toll on the quality of students' lives and education. There is plenty of existing documentation on the effects of socioeconomic status on risky drinking behavior amongst college students. For example, a paper by Susan E. Collins, PhD, professor and licensed clinical psychologist, found that individuals with lower socioeconomic status as well as people of racial and ethnic minorities and homelessness experience greater alcohol-related consequences. Additionally, studies from the National Institutes of Health have found that "aspects of college life---such as unstructured time, widespread availability of alcohol, inconsistent enforcement of underage drinking laws, and limited interactions with parents and other adults" drives up rates of underage drinking, and "college students have higher binge-drinking rates and a higher incidence of driving under the influence of alcohol than their noncollege peers." Since most existing literature on underage student drinking focuses on college students, we wanted to examine the factors contributing to drinking amongst secondary school students. Our research question is as follows:

How do social indicators affect student alcohol consumption in secondary schools?

We hypothesize that factors like familial status, family and school support, and other social and economic indicators will strongly influence the rates that secondary school students consume alcohol and that increased alcohol consumption is correlated with their school performance.

## Data description

```{r}
alc <- read_csv("~/project-Hypothesis-Heroes/data/student-por.csv")
```

This data is from a Kaggle public dataset, originally sourced from the UC Irvine Machine Learning Repository. The data consists of information collected in 2008 on secondary school students from two schools in Portugal: Gabriel Pereira and Mousinho da Silveira. There are 649 observations, each one being a student, and 33 variables which cover a range of characteristics about each student's family, education, social situation, alcohol consumption, and grades in their Portuguese language class.

## Methodology

```{r}
alc <- alc |>
  mutate(Pstatus = ifelse(Pstatus == "T", "Together", "Apart"))
```

```{r}
#| label: split-data
set.seed(210)
alc_split <- initial_split(alc, prop = 0.75)
alc_train <- training(alc_split)
alc_test <- testing(alc_split)
```

```{r}
#| label: specify-model
alc_spec <- linear_reg() |>
  set_engine("lm")
  
alc_spec
```

### Model 1

```{r}
#| label: create-recipe
alc_rec1 <- recipe(Walc ~ sex + Pstatus + schoolsup + famsup + Mjob + Fjob + freetime + studytime + absences + failures, data = alc) |>
  step_dummy(all_nominal_predictors()) |>
  #step_cut(freetime, studytime, breaks = c(1, 2, 3, 4, 5)) |>
  #step_cut(failures, studytime, breaks = c(0, 1, 2, 3, 4)) |>
  step_interact(terms =~ freetime:studytime) |>
  step_interact(terms =~ failures:studytime) |>
  step_interact(terms =~ failures:absences) |>
  step_interact(terms =~ famsup:mjob) |>
  step_interact(terms =~ famsup:fjob) |>
  step_zv(all_predictors())

alc_rec1
```

```{r}
alc_spec <- linear_reg() |>
  set_engine("lm")

alc_wflow <- workflow() |>
  add_model(alc_spec) |>
  add_recipe(alc_rec1) 


alc_fit <- alc_wflow |>
  fit(data = alc_train)

tidy(alc_fit) |>
  kable(digits = 3)


```

```{r}
#replace lm1 with the fitted recipe
lm1 = lm(Walc ~ famsup + studytime + Pstatus + freetime,studentalc)

stepAIC(lm1, direction = "backward") |>
  tidy()
```

::: callout-important
Before you submit, make sure your code chunks are turned off with `echo: false` and there are no warnings or messages with `warning: false` and `message: false` in the YAML.
:::
